<div class="content">

<% 7.times do |i| %>

  <div id=<%= i.to_s %> class="column board">

    <% 6.times do |j| %>

      <div id=<%= "#{i}-#{5 - j}" %> class="row board"></div>

    <% end %>

  </div>

<% end %>

</div>

<script>
  var last_turn = "";

  var player = {};
  var getPlayer = function() {
    $.ajax({
      url: window.location.pathname + "/usertype",
      type: "post",
      dataType: "json",
      success: function(data) { player = data; }
    });
  }
  getPlayer();


  function getBoard() {
  $.ajax({
      url: window.location.pathname + "/board",
      dataType: "json",
      success: function(data) {
        var moves = data;
        updateBoard(moves);
      },
      complete: function() { setTimeout(getBoard, 100); }
    });
  };
  getBoard();



  function updateBoard(moves) {
    for (var i = 0; i < moves.length; i++) {
      if (moves[i].player == "player1") {
        var color = "red";
      } else if (moves[i].player == "player2") {
        var color = "black";
      };
      $("#" + moves[i].column + "-" + moves[i].row).css("background-color", color);
    };
    last_turn = moves[moves.length - 1].player
  };



  $(".column").click(function(e) {
    e.preventDefault();
    
    if (last_turn != player.type) {
      var column = parseInt($(this).attr("id"));
      var row = 0;
      for (var i = 0; i <= 5; i++) {
        if ($("#" + column + " div").eq(i).css("background-color") == "rgb(255, 255, 255)") { row = 5 - i; }
      }
      $.ajax({
        url: window.location.pathname + "/move",
        type: "post",
        dataType: "string",
        data: { row: row, column: column, user: player.user }
      });
    } else {
      alert("It's not your turn.");
    };
  });

</script>